{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/usingpromise","result":{"data":{"markdownRemark":{"id":"989ebe24-7d0e-5d52-b674-e24d25d3bb73","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0e4fdce8ac22e09688c580e5bc4dcd7d/f0628/javascript_logo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAAB3UlEQVQ4y2P4fl+ObMQwqnmQaP7xAIQg7K93QexfD+W+3QMhwpq/3AXpgbD/vZQHct9dl/39VP7vM3mIfiyagRK/Hsm9vy5rZ8ER6Mn16bbsv6fyU9qENFRYxUSYgzy5Lu6R/PMYpB+75t+P5F5fkWVjY5SRYAbq3LhAjIGBQUqC2cqUHchIieL5/1we6Cicmt9cleXkZJSTZvn/RqG2kB+oZ3af8P/vihvniz4+Iw30PE5nQzVzMMpJsfx/IT+vTxioWVudbfk0ke9P5IHGfbuL188QzYqyLJ9vg4ItzJeLAQxUFFk2LxLF7uyv90Dx8euh/KvLshxAzXIsH2/KAoP35wv5tbNFXe05gPp5eRjP7JD8/0weVfM9uX8v5J+clwGSXx/IATUryLIAbXh1RQak+rvS/59Kxel8QP099YL/PyggNAMVAb03t08YaHBfg+DUNiGgIntLjp8P5G3N2dnZGPsbhfasFHexAVm+cKLw/7cYmjfMF+XmYoR4j5mZYcV0kf/vFKa1C/FwgwSZmEDi7g4cH27I/nyA6mdgUP1/JX/rmPTUdiGg5ad3SP4DJyaI4Kxu4a5awfVzRT/flf39WA5LIgEK/QFGxlsFoIXwZAh0FFwQaBAwkUPEAUiGpWGNv+yDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/0e4fdce8ac22e09688c580e5bc4dcd7d/8ac56/javascript_logo.webp 240w,\n/static/0e4fdce8ac22e09688c580e5bc4dcd7d/d3be9/javascript_logo.webp 480w,\n/static/0e4fdce8ac22e09688c580e5bc4dcd7d/e46b2/javascript_logo.webp 960w,\n/static/0e4fdce8ac22e09688c580e5bc4dcd7d/92f8c/javascript_logo.webp 1200w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/0e4fdce8ac22e09688c580e5bc4dcd7d/e4891/javascript_logo.png 240w,\n/static/0e4fdce8ac22e09688c580e5bc4dcd7d/0ce91/javascript_logo.png 480w,\n/static/0e4fdce8ac22e09688c580e5bc4dcd7d/b7c40/javascript_logo.png 960w,\n/static/0e4fdce8ac22e09688c580e5bc4dcd7d/f0628/javascript_logo.png 1200w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/0e4fdce8ac22e09688c580e5bc4dcd7d/b7c40/javascript_logo.png\"\n          alt=\"javascript logo\"\n          title=\"javascript logo\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<h3 id=\"promise-를-이용해서-api-받아오기\"><a href=\"#promise-%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4%EC%84%9C-api-%EB%B0%9B%EC%95%84%EC%98%A4%EA%B8%B0\" aria-label=\"promise 를 이용해서 api 받아오기 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Promise 를 이용해서 API 받아오기</h3>\n<p>API 를 받아오는 Request 라는 함수를 생성했다.\n아래 script 는 함수 전체 모습이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ApiUtil.js 파일</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Request</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">method<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> body <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    method<span class=\"token punctuation\">:</span> method<span class=\"token punctuation\">,</span>\n    headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"application/json\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    body<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> res<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Request<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">fetch</code>함수 자체를 return 해줘야 <code class=\"language-text\">Request</code>함수를 사용할 때, Promise 를 받을 수 있다.</p>\n<p>이 함수가 사용될때는 아래와 같이 사용된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">_first</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">innerFunc</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_second</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> a<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">innerFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// console.log(\"then\", res);</span>\n      <span class=\"token keyword\">let</span> memberInfo <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> memberInfo<span class=\"token punctuation\">:</span> memberInfo <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'catch'</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function-variable function\">_second</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_loginInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// console.log(res);</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function-variable function\">_loginInfo</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    memberId<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>memberId<span class=\"token punctuation\">,</span>\n    memberPw<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>memberPw<span class=\"token punctuation\">,</span>\n    registerTypeCd<span class=\"token punctuation\">:</span> <span class=\"token string\">'email'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">Request</span><span class=\"token punctuation\">(</span><span class=\"token string\">'post'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>설명</p>\n<ol>\n<li>로그인 버튼을 클릭하게 되면 <code class=\"language-text\">_first</code> 함수가 실행된다.</li>\n<li><code class=\"language-text\">_first</code> 함수 내부에는 <code class=\"language-text\">innerFunc</code>가 선언되어 있고, <code class=\"language-text\">innerFunc</code>가 실행된다.</li>\n<li><code class=\"language-text\">innerFunc</code> 는 async 함수이므로 <code class=\"language-text\">_second</code> 함수를 기다린다.</li>\n<li>이제 <code class=\"language-text\">_second</code> 함수가 실행된다.</li>\n<li><code class=\"language-text\">_second</code> 함수는 <code class=\"language-text\">_loginInfo</code> 함수를 실행한다.</li>\n<li><code class=\"language-text\">_loginInfo</code> 함수는 <code class=\"language-text\">Request</code> 함수가 실행되기를 기다린다. 이제 <code class=\"language-text\">Request</code> 함수가 실행된다.</li>\n<li>드디어 <code class=\"language-text\">Request</code> 함수가 실행하는데, <code class=\"language-text\">fetch</code>\n함수를 사용했으므로, <code class=\"language-text\">JSON.stringify</code>가 필요함.</li>\n<li>API 결과를 확인해서 <code class=\"language-text\">Promise.resolve(result)</code>를 선언하여 <code class=\"language-text\">resolve</code> 시킨다.</li>\n<li>이제 <code class=\"language-text\">resolve</code> 가 떨어졌으니 앞선 함수 선언들이 모두 resolve 상태로 쭉 이어나갈 것이다.</li>\n</ol>\n<p>Promise 와 async/await 을 같이 공부하면서 테스트 해서 쓸데없는 선언이 많아졌다.</p>\n<p>앞으로 API를 이용하면서 사용할 수 있는 예제가 될것 같다.</p>\n<p>오랜만의 블로그 정리 끝.</p>","fields":{"slug":"/posts/usingpromise","tagSlugs":null},"frontmatter":{"date":"2020-07-26T13:36:32.169Z","description":"Promise 를 이용해서 API 받아오는 과정처리","tags":null,"title":"Promise 활용","socialImage":"/media/javascript_logo.png"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/usingpromise"}}}